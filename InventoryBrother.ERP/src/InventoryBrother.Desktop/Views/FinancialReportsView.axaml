<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:InventoryBrother.Desktop.ViewModels"
             xmlns:loc="using:InventoryBrother.Desktop.Extensions"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="InventoryBrother.Desktop.Views.FinancialReportsView"
             x:DataType="vm:FinancialReportsViewModel">

    <Grid RowDefinitions="Auto,Auto,*">
        <TextBlock Text="{loc:Localize accounting.FinancialReports}" FontSize="20" FontWeight="Bold" Margin="20"/>

        <!-- Filters -->
        <Border Grid.Row="1" Margin="20,0" Padding="10" Background="White" CornerRadius="5">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="{loc:Localize accounting.From}" VerticalAlignment="Center"/>
                <CalendarDatePicker SelectedDate="{Binding FromDate}"/>
                <TextBlock Text="{loc:Localize accounting.To}" VerticalAlignment="Center"/>
                <CalendarDatePicker SelectedDate="{Binding ToDate}"/>
                
                <Button Command="{Binding GenerateTrialBalanceCommand}" Content="{loc:Localize accounting.RunTrialBalance}" Classes="Primary"/>
                <Button Command="{Binding GenerateProfitLossCommand}" Content="{loc:Localize accounting.RunProfitLoss}" Classes="Primary"/>
                <Button Command="{Binding ExportToExcelCommand}" Content="{loc:Localize Export}" Background="#2E7D32" Classes="Primary"/>
            </StackPanel>
        </Border>

        <!-- Report Output -->
        <ScrollViewer Grid.Row="2" Margin="20">
            <StackPanel>
                <!-- Trial Balance -->
                <StackPanel IsVisible="{Binding ShowTrialBalance}">
                    <TextBlock Text="{loc:Localize accounting.TrialBalance}" FontSize="18" FontWeight="SemiBold" Margin="0,10"/>
                    <DataGrid ItemsSource="{Binding TrialBalance.Lines}" AutoGenerateColumns="False" IsReadOnly="True" GridLinesVisibility="Horizontal" BorderThickness="1" BorderBrush="{StaticResource BorderBrush}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{loc:Localize accounting.Code}" Binding="{Binding AccountCode}"/>
                            <DataGridTextColumn Header="{loc:Localize accounting.Name}" Binding="{Binding AccountName}" Width="*"/>
                            <DataGridTextColumn Header="{loc:Localize accounting.Debit}" Binding="{Binding Debit}"/>
                            <DataGridTextColumn Header="{loc:Localize accounting.Credit}" Binding="{Binding Credit}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="20" Margin="0,10">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                             <TextBlock Text="{loc:Localize accounting.TotalDebit}" FontWeight="Bold"/>
                             <TextBlock Text=":" FontWeight="Bold"/>
                             <TextBlock Text="{Binding TrialBalance.TotalDebit, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                             <TextBlock Text="{loc:Localize accounting.TotalCredit}" FontWeight="Bold"/>
                             <TextBlock Text=":" FontWeight="Bold"/>
                             <TextBlock Text="{Binding TrialBalance.TotalCredit, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- P&L -->
                <StackPanel IsVisible="{Binding !ShowTrialBalance}">
                    <TextBlock Text="{loc:Localize accounting.IncomeStatement}" FontSize="18" FontWeight="SemiBold" Margin="0,10"/>
                    
                    <TextBlock Text="{loc:Localize accounting.Income}" FontWeight="Bold" Margin="0,5"/>
                    <ItemsControl ItemsSource="{Binding ProfitLoss.IncomeDetails}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Margin="10,2">
                                    <TextBlock Text="{Binding AccountName}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat='{}{0:C}'}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border BorderBrush="Gray" BorderThickness="0,1,0,0" Margin="0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="{loc:Localize accounting.TotalIncome}" FontWeight="Bold"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.TotalIncome, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                    </Grid>

                    <TextBlock Text="{loc:Localize accounting.Expenses}" FontWeight="Bold" Margin="0,15,0,5"/>
                    <ItemsControl ItemsSource="{Binding ProfitLoss.ExpenseDetails}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Margin="10,2">
                                    <TextBlock Text="{Binding AccountName}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat='{}{0:C}'}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border BorderBrush="Gray" BorderThickness="0,1,0,0" Margin="0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="{loc:Localize accounting.TotalExpense}" FontWeight="Bold"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.TotalExpense, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                    </Grid>

                    <Border BorderBrush="Black" BorderThickness="0,2,0,0" Margin="0,15,0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="{loc:Localize accounting.NetProfit}" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.NetProfit, StringFormat='{}{0:C}'}" FontWeight="Bold" FontSize="16" Foreground="Green"/>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
