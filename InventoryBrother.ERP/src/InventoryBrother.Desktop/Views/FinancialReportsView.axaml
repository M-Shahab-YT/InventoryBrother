<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:InventoryBrother.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="InventoryBrother.Desktop.Views.FinancialReportsView"
             x:DataType="vm:FinancialReportsViewModel">

    <Grid RowDefinitions="Auto,Auto,*">
        <TextBlock Text="Financial Reports" FontSize="20" FontWeight="Bold" Margin="20"/>

        <!-- Filters -->
        <Border Grid.Row="1" Margin="20,0" Padding="10" Background="White" CornerRadius="5">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="From:" VerticalAlignment="Center"/>
                <CalendarDatePicker SelectedDate="{Binding FromDate}"/>
                <TextBlock Text="To:" VerticalAlignment="Center"/>
                <CalendarDatePicker SelectedDate="{Binding ToDate}"/>
                
                <Button Command="{Binding GenerateTrialBalanceCommand}" Content="Run Trial Balance"/>
                <Button Command="{Binding GenerateProfitLossCommand}" Content="Run P&amp;L"/>
                <Button Command="{Binding ExportToExcelCommand}" Content="Export to Excel" Background="#2E7D32" Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- Report Output -->
        <ScrollViewer Grid.Row="2" Margin="20">
            <StackPanel>
                <!-- Trial Balance -->
                <StackPanel IsVisible="{Binding ShowTrialBalance}">
                    <TextBlock Text="Trial Balance" FontSize="18" FontWeight="SemiBold" Margin="0,10"/>
                    <DataGrid ItemsSource="{Binding TrialBalance.Lines}" AutoGenerateColumns="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Code" Binding="{Binding AccountCode}"/>
                            <DataGridTextColumn Header="Account" Binding="{Binding AccountName}" Width="*"/>
                            <DataGridTextColumn Header="Debit" Binding="{Binding Debit}"/>
                            <DataGridTextColumn Header="Credit" Binding="{Binding Credit}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="20" Margin="0,10">
                        <TextBlock Text="{Binding TrialBalance.TotalDebit, StringFormat='Total Debit: {0:C}'}" FontWeight="Bold"/>
                        <TextBlock Text="{Binding TrialBalance.TotalCredit, StringFormat='Total Credit: {0:C}'}" FontWeight="Bold"/>
                    </StackPanel>
                </StackPanel>

                <!-- P&L -->
                <StackPanel IsVisible="{Binding !ShowTrialBalance}">
                    <TextBlock Text="Profit &amp; Loss" FontSize="18" FontWeight="SemiBold" Margin="0,10"/>
                    
                    <TextBlock Text="Income" FontWeight="Bold" Margin="0,5"/>
                    <ItemsControl ItemsSource="{Binding ProfitLoss.IncomeDetails}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Margin="10,2">
                                    <TextBlock Text="{Binding AccountName}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat='{}{0:C}'}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border BorderBrush="Gray" BorderThickness="0,1,0,0" Margin="0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Total Income" FontWeight="Bold"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.TotalIncome, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                    </Grid>

                    <TextBlock Text="Expenses" FontWeight="Bold" Margin="0,15,0,5"/>
                    <ItemsControl ItemsSource="{Binding ProfitLoss.ExpenseDetails}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Margin="10,2">
                                    <TextBlock Text="{Binding AccountName}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat='{}{0:C}'}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border BorderBrush="Gray" BorderThickness="0,1,0,0" Margin="0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Total Expense" FontWeight="Bold"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.TotalExpense, StringFormat='{}{0:C}'}" FontWeight="Bold"/>
                    </Grid>

                    <Border BorderBrush="Black" BorderThickness="0,2,0,0" Margin="0,15,0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="NET PROFIT" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Grid.Column="1" Text="{Binding ProfitLoss.NetProfit, StringFormat='{}{0:C}'}" FontWeight="Bold" FontSize="16" Foreground="Green"/>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
